import{a as b,b as N,c as A,d as L,f as F,i as k,k as T,l as z,m as j,n as B}from"./chunk-XRDREU5A.js";import{$ as O,A as v,H as m,K as h,L as g,M as u,N as a,O as s,P as f,R as _,W as p,Y as E,Z as M,_ as y,aa as P,f as x,i as C,l as n,la as I,pa as w,ra as S,w as r}from"./chunk-KGPZSK6B.js";var c=class o{http=n(I);GetAllEpisodes(t){let e=`${b}/episode/?page=${t}`;return this.http.get(e)}GetEpisodeById(t){let e=`${b}/episode/${t}`;return this.http.get(e)}static \u0275fac=function(e){return new(e||o)};static \u0275prov=C({token:o,factory:o.\u0275fac,providedIn:"root"})};function R(o,t){if(o&1&&(a(0,"option",6),p(1),s()),o&2){let e=t.$implicit;m("value",e),r(),E("Episode - ",e,"")}}function $(o,t){if(o&1&&f(0,"app-cards",9),o&2){let e=t.$implicit;m("character",e)}}var D=class o{episodes=[];characters=[];countEpisode=[];page=1;selectedEpisodeId=1;air_date="";episodeName="";episodeNumber="";router=n(S);route=n(w);service=n(c);charactersService=n(N);ngOnInit(){this.route.queryParamMap.subscribe(t=>{let e=t.get("episode");e&&(this.selectedEpisodeId=Number(e)),this.getAllEpisodes(this.page)})}getAllEpisodes(t){this.service.GetAllEpisodes(t).subscribe(e=>{this.episodes=e.results,this.countEpisode=Array.from({length:e.info.count},(i,l)=>l+1),this.selectedEpisodeId&&this.loadCharactersForEpisode(this.selectedEpisodeId)})}loadCharactersForEpisode(t){let e=this.findEpisodeInList(t);e?(this.updateEpisodeInfo(e),this.loadCharacterDetails(e.characters)):this.fetchAndLoadEpisode(t)}findEpisodeInList(t){return this.episodes.find(e=>e.id===t)}updateEpisodeInfo(t){this.episodeName=t.name??"",this.air_date=t.air_date??"",this.episodeNumber=t.episode??""}loadCharacterDetails(t){let e=t.map(i=>this.charactersService.GetCharacterById(this.extractIdFromUrl(i)));x(e).subscribe(i=>{this.characters=i})}fetchAndLoadEpisode(t){this.service.GetEpisodeById(t).subscribe(e=>{e?(this.updateEpisodeInfo(e),this.loadCharacterDetails(e.characters)):console.error("Epis\xF3dio n\xE3o encontrado ou resposta da API inv\xE1lida")})}onEpisodeSelect(t){let e=Number(t.target.value);this.selectedEpisodeId=e,this.router.navigate([],{queryParams:{episode:e},queryParamsHandling:"merge"}),this.loadCharactersForEpisode(e)}extractIdFromUrl(t){let e=t.match(/\/(\d+)$/);return e?Number(e[1]):0}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=v({type:o,selectors:[["app-episode-listing"]],decls:17,vars:4,consts:[[1,"container"],[1,"header"],[1,"content-title"],[1,"description"],[1,"content-search"],["name","episode-number","id","episode-number",3,"change","ngModelChange","ngModel"],[3,"value"],["for","episode-number"],[1,"wrapper-cards"],[3,"character"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3"),p(4),s(),a(5,"p",3),p(6),s()(),a(7,"div",4)(8,"select",5),_("change",function(d){return i.onEpisodeSelect(d)}),P("ngModelChange",function(d){return O(i.selectedEpisodeId,d)||(i.selectedEpisodeId=d),d}),g(9,R,2,2,"option",6,h),s(),a(11,"label",7),p(12,"Search by episode"),s()()(),a(13,"div",8),g(14,$,1,1,"app-cards",9,h),s()(),f(16,"app-footer")),e&2&&(r(4),E("Episode ",i.episodeName,""),r(2),M("",i.episodeNumber," - ",i.air_date,""),r(2),y("ngModel",i.selectedEpisodeId),r(),u(i.countEpisode),r(5),u(i.characters))},dependencies:[L,A,B,z,j,T,F,k],styles:[".container[_ngcontent-%COMP%]{height:auto;min-height:calc(100dvh - 88px);padding-top:72px;background:var(--background);color:var(--text-title)}.header[_ngcontent-%COMP%]{padding:32px 32px 0;display:flex;align-items:center;justify-content:space-between}.header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.875rem}@media screen and (max-width: 600px){.header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.5rem}}.header[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{color:var(--text-body);font-size:.875rem;line-height:1.4285714286;margin-top:2px}@media screen and (max-width: 600px){.header[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{font-size:.75rem}}.header[_ngcontent-%COMP%]   .content-search[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}.header[_ngcontent-%COMP%]   .content-search[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:120px;padding:8px;color:var(--text-body);font-size:.875rem;border-radius:6px;background:var(--shape);border:1px solid var(--border);-webkit-box-shadow:0px 6px 30px 0px rgba(37,37,41,.6);-moz-box-shadow:0px 6px 30px 0px rgba(37,37,41,.6);box-shadow:0 6px 30px #25252999}.header[_ngcontent-%COMP%]   .content-search[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{outline:1px solid var(--red)}.header[_ngcontent-%COMP%]   .content-search[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:var(--text-body);font-weight:400;font-size:.875rem;line-height:1.4285714286}.wrapper-cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(500px,1fr));padding:32px;gap:24px}@media screen and (max-width: 600px){.wrapper-cards[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fill,minmax(200px,1fr))}}@media screen and (max-width: 386px){.wrapper-cards[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fill,minmax(300px,1fr))}}.wrapper-residents[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;overflow-y:auto}"]})};export{D as EpisodeListingComponent};
